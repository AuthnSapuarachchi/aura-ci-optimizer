# This is the name of your workflow
name: Deploy to Render

# This tells GitHub WHEN to run the workflow
on:
  # Run this on every push to the "main" branch
  push:
    branches:
      - main

# This defines the "jobs" (tasks) to run
jobs:
  # --- Job 1: Deploy the Backend ---
  deploy-backend:
    # Only run this job if files *inside* the backend-spring folder were changed
    if: "contains(join(github.event.commits.*.files, ' '), 'backend-spring/')"

    # Use a standard Linux machine to run the job
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Render Deploy (Backend)
        # We use a simple "curl" command to visit the secret URL
        run: curl ${{ secrets.RENDER_DEPLOY_HOOK_BACKEND }}

  # --- Job 2: Deploy the ML Service ---
  deploy-ml-service:
    # Only run this job if files *inside* the ml-service folder were changed
    if: "contains(join(github.event.commits.*.files, ' '), 'ml-service/')"

    runs-on: ubuntu-latest

    steps:
      - name: Trigger Render Deploy (ML Service)
        run: curl ${{ secrets.RENDER_DEPLOY_HOOK_ML }}

  # --- Job 3: Deploy the Frontend (Vercel) ---
  # We don't need a job for Vercel. Vercel automatically watches
  # your "frontend" folder and deploys on its own.
  # This section is just a note!
